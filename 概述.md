### 1. 项目概述

这个项目是一个**基于机器学习的数据库基数估计任务**。基数估计在数据库查询优化中非常重要，基数指的是查询结果集的行数估计值。数据库优化器依赖于精确的基数估计来优化查询执行计划，提高查询效率。

本项目通过提供特定的IMDB数据库查询和基于列统计信息的模型，训练机器学习模型来估计查询结果的基数。该任务的最终目标是通过模型的**估计结果**与**实际结果**进行对比，计算误差并优化基数估计性能。

### 2. 各文件的作用

#### a. **数据文件**：

- **`query_train_18000.json`** 和 **`validation_2000.json`**：
    
    - 包含数据库查询及对应的实际返回行数（基数），这些数据是用于模型训练和验证的​(query_train_18000)​(validation_2000)。
- **`title_stats.json`**：
    
    - 这是关于IMDB数据库表 `title` 的统计数据文件。它提供了每列的直方图、NDV（不同值数量）、bucket（区间分布）等信息，供模型在训练中进行参考，帮助模型更好地估计基数​(title_stats)。

#### b. **代码文件**：

- **`range_query.py`**：
    
    - 该文件定义了查询解析类 `ParsedRangeQuery`，主要用于解析SQL查询中的范围条件（如`c1 > x AND c1 < y`）​(range_query)。它负责将查询拆解成查询的左边界和右边界，供后续的基数估计使用。
- **`statistics.py`**：
    
    - 该文件定义了数据库表的统计数据类 `TableStats` 和列的统计类 `ColumnStats`，用于加载和处理表统计信息，如直方图、NDV 等。这些统计数据是基数估计的核心参考数据​(statistics)。
- **`test_result.py`**：
    
    - 这是一个简单的测试文件，使用 `pytest` 来验证预测模型的输出，检查多个模型估计的基数和实际基数之间的一致性，确保训练和预测过程中的数据处理正常​(test_result)。
- **`evaluation.py`** 和 **`evaluation_utils.py`**：
    
    - `evaluation.py` 负责生成实验报告、对多个模型进行误差分析，并绘制基数估计图形​(evaluation)。
    - `evaluation_utils.py` 提供了绘制实际与估计基数对比图的工具，以及误差的计算方法（如p50, p80, p90等百分位误差分布）​(evaluation_utils)。
- **`learn_from_query.py`**：
    
    - 该文件实现了机器学习模型的训练和预测过程，包括 `est_AI1` 和 `est_AI2` 两个模型的估计方法。它将查询转化为特征向量，并使用回归模型来估计基数​(learn_from_query)。

#### c. **其他文件**：

- **`range_query.py`** 和 **`learn_from_query.py`**：
    
    - 解析查询的范围条件并提取特征，将其输入到机器学习模型中。
- **`title_schema.sql`**：
    
    - 定义了数据库的表结构和列，供项目中读取和参考。


### 3. 项目分析

#### a. **核心任务：基数估计**

- 项目的核心是对给定的SQL查询进行基数估计，即估计这些查询将返回多少行数据。基数估计是数据库优化中的关键任务，通常依赖于数据的分布和列的统计信息。文件中的 `title_stats.json` 提供了列的统计数据，供模型在基数估计时使用。

#### b. **数据预处理与特征提取**

- 通过 `range_query.py` 和 `statistics.py`，SQL查询被解析成范围条件（例如 `c1 > 10 AND c1 < 100`），这些条件被转化为特征，结合列的统计数据来生成估计。通过 `learn_from_query.py`，特征会被转化为模型的输入，用于训练机器学习模型。

#### c. **模型训练与评估**

- 该项目提供了两个机器学习模型：`est_AI1` 和 `est_AI2`。这两个模型通过提取的查询特征和统计数据进行训练，来估计基数。`evaluation.py` 和 `evaluation_utils.py` 则用于生成报告和分析模型性能，主要依赖于误差百分位（如p50, p80, p90等）来衡量模型的精度。

#### d. **实验流程**

- 实验流程包括：将训练数据划分为训练集和验证集，训练模型，并根据 `readme.txt` 的要求生成预测结果和报告。在最终评估时，系统将使用新的测试数据来验证模型的泛化能力。

#### e. **评估标准**

- 评估标准是模型的误差，即预测的基数与实际基数之间的偏差。通过生成误差分布图（p50, p80, p90等）来评估模型的表现​(evaluation)​(evaluation_utils)。